"use strict";angular.module("fitbit.controllers",[]),angular.module("fitbit.factories",[]),angular.module("fitbit.services",[]),angular.module("fitbit",["fitbit.controllers","fitbit.factories","fitbit.services","ui.router"]),angular.module("fitbit").config(["$stateProvider","$urlRouterProvider","$httpProvider","States",function(t,e,r,o){function i(e,r){angular.forEach(e,function(e,o){e.parent=r,e.parent?e.name=r+"."+o:e.name=o,e.templateUrl="templates/"+e.templateUrl,t.state(e.name,e),e.children&&i(e.children,e.name)})}e.otherwise("/"),r.interceptors.push("authorizationInterceptor"),i(o)}]),angular.module("fitbit").run(["$rootScope","$state","AuthorizationService",function(t,e,r){t.$on("unauthorized",function(){e.go("unauthorized")}),t.$on("authorized",function(){e.go("authorized")})}]);var Routes={authorize:"authorize",heartrateSeries:"heartrate/series"};angular.module("fitbit").constant("States",function(){var t=function(t){angular.extend(this,t)};return{authorized:new t({url:"/",controller:"MainController",templateUrl:"general.html",onEnter:["$state","AuthorizationService",function(t,e){e.authorized||t.go("unauthorized")}]}),unauthorized:new t({url:"/unauthorized",controller:"UnauthorizedController",templateUrl:"unauthorized.html",onEnter:["$state","AuthorizationService",function(t,e){e.authorized&&t.go("authorized")}]})}}()),angular.module("fitbit.controllers").controller("MainController",["$scope","$http",function(t,e){t.heartRate=function(){e.get(Routes.heartrateSeries).then(function(t){})}}]),angular.module("fitbit.controllers").controller("UnauthorizedController",["$scope","AuthorizationService",function(t,e){t.authorizationService=e}]),angular.module("fitbit.factories").factory("authorizationInterceptor",["$rootScope","$q",function(t,e){return{responseError:function(r){return 401===r.status&&t.$broadcast("unauthorized"),e.reject(r)}}}]),angular.module("fitbit.services").service("AuthorizationService",["$http","$rootScope",function(t,e){function r(){a.authorized=!0,e.$broadcast("authorized")}function o(){a.authorized=!1,e.$broadcast("unauthorized")}function i(t){302===t.status&&(a.authorized=!1,window.location.href=t.data)}function n(){return Routes.authorize+"?url="+encodeURIComponent(window.location.href.split("#")[0])}var a=this;this.authorize=function(){t.get(n()).then(r,i)},this.checkAuthorized=function(){t.get(n()).then(r,o)},this.checkAuthorized()}]);